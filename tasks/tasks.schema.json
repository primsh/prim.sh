{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://prim.sh/tasks.schema.json",
  "title": "Prim Tasks",
  "description": "Structured task hierarchy for the Prim project. SOT for task state.",
  "type": "object",
  "required": ["sections"],
  "additionalProperties": false,
  "properties": {
    "sections": {
      "type": "array",
      "items": { "$ref": "#/$defs/Section" }
    }
  },
  "$defs": {
    "Status": {
      "type": "string",
      "enum": ["pending", "in-progress", "done", "backlog"]
    },
    "Parallelism": {
      "type": "string",
      "enum": ["PARA", "SRL"]
    },
    "Task": {
      "type": "object",
      "required": ["id", "description", "owner", "depends", "status"],
      "additionalProperties": false,
      "properties": {
        "id": { "type": "string", "description": "Unique task ID (e.g. HRD-3, L-27)" },
        "description": {
          "type": "string",
          "description": "Task summary, ~120 chars. Plan references stripped."
        },
        "owner": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Owners. 'Garric + Claude' â†’ ['Garric', 'Claude']"
        },
        "depends": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Task IDs this task depends on. [] if none."
        },
        "status": { "$ref": "#/$defs/Status" },
        "release": {
          "oneOf": [{ "type": "string", "pattern": "^v\\d+\\.\\d+\\.\\d+$" }, { "type": "null" }],
          "description": "Semver release this task blocks, or null."
        },
        "plan": {
          "type": "string",
          "description": "Path to plan doc, e.g. tasks/active/hrd-4-json-parse-safety.md"
        }
      }
    },
    "Phase": {
      "type": "object",
      "required": ["id", "title", "tasks"],
      "additionalProperties": false,
      "properties": {
        "id": { "type": "string", "description": "Phase ID (e.g. HRD-W1-PA)" },
        "title": { "type": "string" },
        "parallelism": { "$ref": "#/$defs/Parallelism" },
        "tasks": {
          "type": "array",
          "items": { "$ref": "#/$defs/Task" }
        }
      }
    },
    "Wave": {
      "type": "object",
      "required": ["id", "title"],
      "additionalProperties": false,
      "properties": {
        "id": { "type": "string", "description": "Wave ID (e.g. HRD-W1)" },
        "title": { "type": "string" },
        "parallelism": { "$ref": "#/$defs/Parallelism" },
        "phases": {
          "type": "array",
          "items": { "$ref": "#/$defs/Phase" },
          "description": "Present if wave contains phases. Mutually exclusive with tasks."
        },
        "tasks": {
          "type": "array",
          "items": { "$ref": "#/$defs/Task" },
          "description": "Present if wave contains tasks directly (no phases)."
        }
      }
    },
    "Section": {
      "type": "object",
      "required": ["id", "title", "waves"],
      "additionalProperties": false,
      "properties": {
        "id": { "type": "string", "description": "Section abbreviation (e.g. HRD, PRIMS)" },
        "title": { "type": "string" },
        "description": { "type": "string" },
        "waves": {
          "type": "array",
          "items": { "$ref": "#/$defs/Wave" }
        }
      }
    }
  }
}
