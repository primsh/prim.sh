# gitleaks v8 configuration for prim.sh
# Run: gitleaks detect --source . --log-opts="--all" --verbose
# CI:  gitleaks detect --source . --log-opts="HEAD~1..HEAD" --verbose

title = "prim.sh gitleaks config"

[extend]
# Use the default gitleaks ruleset as a base
useDefault = true

# ── Allowlist: known false positives ─────────────────────────────────────────

[allowlist]
description = "prim.sh global allowlist"

# Ethereum private key — Hardhat/Anvil account #0 (well-known public test key)
# Used in: packages/keystore/test/, packages/x402-client/test/, packages/faucet/test/
# Corresponds to address 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
regexes = [
    "0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80",
    # Hardhat/Anvil account #1 (used in keystore.test.ts)
    "0x59c6995e998f97a5a0044966f0945389dc9e86dae88c7a8412f4603b6b78690d",
    # whsec_ placeholder in plan docs (not a real secret)
    "whsec_abc123",
    # Ethereum token event signature (not a private key)
    "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
    # Zero-address placeholder used in tests
    "0x0000000000000000000000000000000000000001",
    # ERC-20 Ownership transferred event signature
    "0x8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e0",
    # WALLET_MASTER_KEY placeholder (64 'a's — not a real key)
    "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",
    # OpenAPI spec example Ethereum addresses (public contract addresses, not secrets)
    "0xAbCd1234567890abcdef1234567890abCDEF1234",
    "0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913",
    # OpenAPI spec placeholder tokens (not real secrets)
    "rt_abc123def456",
    "ctk_a1b2c3d4e5f6",
]

# Paths excluded from all scans
paths = [
    # Generated EVM contract bytecode — false positive magnet, not credentials
    "packages/token/src/bytecode.ts",
    "packages/token/test/",
    # Completed task plan docs — contain placeholder examples, not real secrets
    "tasks/completed/",
    # Lock files — no secrets, high noise
    "pnpm-lock.yaml",
    "bun.lock",
    # Binary/image assets
    "site/assets/",
]

# ── Prim-specific custom rules ────────────────────────────────────────────────

# Rule: wallet master key (32-byte hex, not starting with all-zeros or all-a's)
[[rules]]
id = "prim-wallet-master-key"
description = "Prim wallet master key (WALLET_MASTER_KEY)"
regex = '''(?i)WALLET_MASTER_KEY\s*=\s*[a-fA-F0-9]{64}'''
tags = ["prim", "key", "wallet"]

  [rules.allowlist]
  regexes = [
      # All-a placeholder from .env.example
      "WALLET_MASTER_KEY=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",
  ]

# Rule: Stalwart admin credentials (base64 user:pass)
[[rules]]
id = "prim-stalwart-api-key"
description = "Stalwart mail server API key (base64 user:pass)"
regex = '''(?i)STALWART_API_KEY\s*=\s*[A-Za-z0-9+/]{20,}={0,2}'''
tags = ["prim", "key", "email", "stalwart"]

  [rules.allowlist]
  regexes = [
      # Empty assignment in .env.example / template
      '''STALWART_API_KEY=\s*$''',
      # Comment in template
      '''# Stalwart API credentials''',
  ]

# Rule: DigitalOcean API token
[[rules]]
id = "prim-do-api-token"
description = "DigitalOcean API token (DO_API_TOKEN)"
regex = '''(?i)DO_API_TOKEN\s*=\s*dop_v1_[A-Za-z0-9]{64}'''
tags = ["prim", "token", "digitalocean"]

# Rule: Prim internal shared secret
[[rules]]
id = "prim-internal-key"
description = "Prim internal service key (PRIM_INTERNAL_KEY / PRIM_ADMIN_KEY)"
regex = '''(?i)(PRIM_INTERNAL_KEY|PRIM_ADMIN_KEY)\s*=\s*[A-Za-z0-9_\-]{16,}'''
tags = ["prim", "key", "internal"]

  [rules.allowlist]
  regexes = [
      # Placeholder patterns
      '''(PRIM_INTERNAL_KEY|PRIM_ADMIN_KEY)\s*=\s*$''',
      '''(PRIM_INTERNAL_KEY|PRIM_ADMIN_KEY)\s*=\s*<''',
      '''(PRIM_INTERNAL_KEY|PRIM_ADMIN_KEY)=\.\.\.|=<key>''',
  ]

# Rule: Faucet treasury key (real private key, not Hardhat test key)
[[rules]]
id = "prim-faucet-treasury-key"
description = "Faucet treasury private key (FAUCET_TREASURY_KEY)"
regex = '''(?i)FAUCET_TREASURY_KEY\s*=\s*0x[a-fA-F0-9]{64}'''
tags = ["prim", "key", "faucet", "privatekey"]

  [rules.allowlist]
  regexes = [
      # Hardhat account #0 (test only)
      "FAUCET_TREASURY_KEY=0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80",
      # Example/placeholder patterns
      "FAUCET_TREASURY_KEY=your_private_key_hex",
      "FAUCET_TREASURY_KEY=0xYOUR_FUNDED_SEPOLIA_PRIVATE_KEY",
  ]

# Rule: Circle API key
[[rules]]
id = "prim-circle-api-key"
description = "Circle API key (CIRCLE_API_KEY)"
regex = '''(?i)CIRCLE_API_KEY\s*=\s*[A-Za-z0-9_\-:]{20,}'''
tags = ["prim", "key", "circle"]

  [rules.allowlist]
  regexes = [
      # Test values only
      '''CIRCLE_API_KEY\s*=\s*["']?test-api-key["']?''',
      '''CIRCLE_API_KEY\s*=\s*$''',
  ]
