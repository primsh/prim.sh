id: email
name: email.sh
endpoint: email.prim.sh
status: deployed
type: email
card_class: p2
description: "Mailboxes on demand. Send, receive, webhook. Disposable or permanent."
port: 3006
order: 5
phantom: false
env:
  - PRIM_PAY_TO
  - PRIM_NETWORK
  - STALWART_URL
  - STALWART_API_KEY
  - EMAIL_DEFAULT_DOMAIN
  - WALLET_INTERNAL_URL
deploy:
  max_body_size: "25MB"
  extra_caddy:
    - |
      mail.prim.sh {
          import security_headers
          request_body { max_size 25MB }
          reverse_proxy localhost:8080
      }

pricing:
  - op: "Create mailbox"
    price: "$0.05"
    note: "24h TTL included"
  - op: "Send email"
    price: "$0.01"
    note: "Up to 10MB"
  - op: "Read messages"
    price: "$0.001"
    note: "Per request"
  - op: "Webhook"
    price: "$0.01"
    note: "Setup + 3 retries"
  - op: "Custom domain"
    price: "$0.05"
    note: "DNS verification required"

accent: "#6C8EFF"
accent_dim: "#5070dd"
accent_glow: "rgba(108,142,255,0.08)"

tagline: "Email for agents. No inbox required."
sub: "Provision addresses, send and receive email, parse inbound messages — all via API. x402 auth. No signup."

hero_badges:
  - "**x402** auth + payment"
  - "**Send** + **Receive**"
  - "**Webhooks** for inbound"
  - "**0** signup required"
  - "**MCP** + **REST**"

hero_example: |
  # Get a mailbox in one request
  $ curl -X POST https://email.prim.sh/v1/mailboxes \
      -H "X-402-Payment: $PAYMENT_TOKEN" \
      -d '{"domain": "email.sh"}'

  # → 402 → pay → 201
  {
    "id": "mbx_r8k2n4",
    "address": "a7x9m2@email.sh",
    "created_at": "2026-02-23T06:30:00Z",
    "webhook": null,
    "ttl": 86400
  }

  # Send email
  $ curl -X POST https://email.prim.sh/v1/send \
      -H "X-402-Payment: $PAYMENT_TOKEN" \
      -d '{"from": "a7x9m2@email.sh", "to": "human@gmail.com",
           "subject": "Task complete", "body": "Your report is ready."}'

quick_start:
  - "POST /v1/mailboxes with {\"domain\": \"mail.prim.sh\"} → create mailbox ($0.05)"
  - "POST /v1/mailboxes/:id/send with to, subject, body → send email ($0.01)"
  - "GET /v1/mailboxes/:id/messages → poll for inbound messages"
  - "POST /v1/mailboxes/:id/webhooks → register webhook for real-time delivery"

tips:
  - "Mailboxes have a 24-hour TTL by default — extend with POST /v1/mailboxes/:id/renew."
  - "Webhook fires on message.received with X-Prim-Signature for HMAC verification."
  - "DELETE /v1/mailboxes/:id permanently deletes the mailbox and all messages."
  - "Custom domains require DNS verification — check POST /v1/domains/:id/verify."
  - "GET /v1/mailboxes/:id/messages returns newest-first with position-based pagination."

limits:
  - "Max message size: 25 MB"
  - "Mailbox default TTL: 24 hours (86400 seconds)"
  - "Webhooks per mailbox: no hard limit documented"

ownership: "All mailboxes and domains are scoped to the wallet address extracted from the x402 payment."

routes_map:
  - route: "POST /v1/mailboxes"
    request: CreateMailboxRequest
    response: MailboxResponse
    status: 201
    description: "Create a mailbox. Optional: username, domain, ttl_ms."
    errors:
      - { status: 400, code: invalid_request, description: "Missing fields or invalid characters" }
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 409, code: username_taken, description: "Username already in use on that domain" }
  - route: "GET /v1/mailboxes"
    request: null
    response: MailboxListResponse
    status: 200
    description: "List mailboxes owned by the calling wallet (paginated)"
    query_params:
      - { name: limit, type: integer, description: "1-100, default 20" }
      - { name: after, type: string, description: "Cursor from previous response" }
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource owned by a different wallet" }
  - route: "GET /v1/mailboxes/:id"
    request: null
    response: MailboxResponse
    status: 200
    description: "Get mailbox metadata including expires_at"
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource owned by a different wallet" }
      - { status: 404, code: not_found, description: "Mailbox not found" }
  - route: "DELETE /v1/mailboxes/:id"
    request: null
    response: DeleteMailboxResponse
    status: 200
    description: "Permanently delete a mailbox and all messages"
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource owned by a different wallet" }
      - { status: 404, code: not_found, description: "Mailbox not found" }
  - route: "POST /v1/mailboxes/:id/renew"
    request: RenewMailboxRequest
    response: MailboxResponse
    status: 200
    description: "Extend mailbox TTL by ttl_ms milliseconds"
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource owned by a different wallet" }
      - { status: 404, code: not_found, description: "Mailbox not found" }
      - { status: 410, code: expired, description: "Mailbox already expired" }
  - route: "GET /v1/mailboxes/:id/messages"
    request: null
    response: EmailListResponse
    status: 200
    description: "List messages in a mailbox, newest first"
    query_params:
      - { name: limit, type: integer, description: "1-100, default 20" }
      - { name: after, type: integer, description: "Position-based cursor for pagination" }
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource owned by a different wallet" }
      - { status: 404, code: not_found, description: "Mailbox not found" }
  - route: "GET /v1/mailboxes/:id/messages/:msgId"
    request: null
    response: EmailDetail
    status: 200
    description: "Get full message including textBody and htmlBody"
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource owned by a different wallet" }
      - { status: 404, code: not_found, description: "Mailbox or message not found" }
  - route: "POST /v1/mailboxes/:id/send"
    request: SendMessageRequest
    response: SendMessageResponse
    status: 200
    description: "Send email from a mailbox. Requires to, subject, and body or html."
    errors:
      - { status: 400, code: invalid_request, description: "Missing required fields" }
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource owned by a different wallet" }
      - { status: 404, code: not_found, description: "Mailbox not found" }
      - { status: 502, code: stalwart_error, description: "Upstream Stalwart mail server error" }
  - route: "POST /v1/mailboxes/:id/webhooks"
    request: RegisterWebhookRequest
    response: WebhookResponse
    status: 201
    description: "Register a webhook URL for message.received events. Optional secret for HMAC signing."
    errors:
      - { status: 400, code: invalid_request, description: "Missing or invalid webhook URL" }
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource owned by a different wallet" }
      - { status: 404, code: not_found, description: "Mailbox not found" }
      - { status: 409, code: conflict, description: "Duplicate webhook URL" }
  - route: "GET /v1/mailboxes/:id/webhooks"
    request: null
    response: WebhookListResponse
    status: 200
    description: "List webhooks for a mailbox"
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource owned by a different wallet" }
      - { status: 404, code: not_found, description: "Mailbox not found" }
  - route: "DELETE /v1/mailboxes/:id/webhooks/:whId"
    request: null
    response: DeleteWebhookResponse
    status: 200
    description: "Delete a webhook"
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource owned by a different wallet" }
      - { status: 404, code: not_found, description: "Mailbox or webhook not found" }
  - route: "POST /v1/domains"
    request: RegisterDomainRequest
    response: DomainResponse
    status: 201
    description: "Register a custom domain. Returns required_records for DNS."
    errors:
      - { status: 400, code: invalid_request, description: "Invalid domain name" }
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 409, code: conflict, description: "Domain already registered" }
  - route: "GET /v1/domains"
    request: null
    response: DomainListResponse
    status: 200
    description: "List registered custom domains (paginated)"
    query_params:
      - { name: limit, type: integer, description: "1-100, default 20" }
      - { name: after, type: string, description: "Cursor from previous response" }
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource owned by a different wallet" }
  - route: "GET /v1/domains/:id"
    request: null
    response: DomainResponse
    status: 200
    description: "Get domain details and verification status"
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource owned by a different wallet" }
      - { status: 404, code: not_found, description: "Domain not found" }
  - route: "POST /v1/domains/:id/verify"
    request: null
    response: VerifyDomainResponse
    status: 200
    description: "Verify DNS records. On success: status → verified, dkim_records returned."
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource owned by a different wallet" }
      - { status: 404, code: not_found, description: "Domain not found" }
      - { status: 502, code: stalwart_error, description: "DNS verification failed" }
  - route: "DELETE /v1/domains/:id"
    request: null
    response: DeleteDomainResponse
    status: 200
    description: "Remove a custom domain registration"
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource owned by a different wallet" }
      - { status: 404, code: not_found, description: "Domain not found" }

cta:
  headline: "Email is an **API call**."
  sub: "Agents don't check inboxes. They poll endpoints and parse JSON."

sections:
  - type: flow
    title: "How"
    highlight: "it works"
    note: "Mailboxes are ephemeral by default (24h TTL). Extend or make permanent with a single API call."
    steps:
      - "Create mailbox"
      - "Send / receive"
      - "Webhook on inbound"
      - "Auto-expire or keep"

  - type: cards
    title: "What agents"
    highlight: "use it for"
    items:
      - title: "Service signups"
        body: "Agent needs a GitHub account? Provision a mailbox, sign up, receive verification email, extract code, verify. All programmatic."
      - title: "Notifications"
        body: "Send task completion emails, error alerts, daily reports. Agents communicating with humans where humans expect it — their inbox."
      - title: "Inbound processing"
        body: "Give a mailbox to a data source. Inbound emails hit your webhook as structured JSON. The agent processes, never checks an inbox."
      - title: "Multi-identity"
        body: "Spin up 50 mailboxes for 50 tasks. Each has its own address. No shared inbox, no routing rules, no filters. Isolation by default."
      - title: "Disposable verification"
        body: "Need an email for a one-time verification? Create a mailbox, poll for the email, extract the link, destroy the mailbox. 30 seconds."
      - title: "Agent-to-agent"
        body: "Agents on different platforms communicating via email. The universal protocol. No API integration needed — just SMTP."

  - type: code
    title: "API"
    highlight: "reference"
    lines:
      - "# Mailbox management"
      - "POST   /v1/mailboxes                         # Create mailbox"
      - "GET    /v1/mailboxes                         # List mailboxes"
      - "GET    /v1/mailboxes/:id                     # Mailbox details"
      - "DELETE /v1/mailboxes/:id                     # Delete mailbox + messages"
      - "POST   /v1/mailboxes/:id/renew               # Extend TTL"
      - ""
      - "# Messages"
      - "GET    /v1/mailboxes/:id/messages            # List messages (newest first)"
      - "GET    /v1/mailboxes/:id/messages/:msgId     # Full message content"
      - ""
      - "# Sending"
      - "POST   /v1/mailboxes/:id/send               # Send email from mailbox"
      - ""
      - "# Webhooks"
      - "POST   /v1/mailboxes/:id/webhooks           # Register webhook"
      - "GET    /v1/mailboxes/:id/webhooks           # List webhooks"
      - "DELETE /v1/mailboxes/:id/webhooks/:whId     # Remove webhook"
      - ""
      - "# Custom domains"
      - "POST   /v1/domains                          # Register domain"
      - "GET    /v1/domains                          # List domains"
      - "GET    /v1/domains/:id                      # Domain details"
      - "POST   /v1/domains/:id/verify               # Verify DNS records"
      - "DELETE /v1/domains/:id                      # Remove domain"
