id: store
name: store.sh
endpoint: store.prim.sh
status: mainnet
type: storage
category: storage
card_class: p4
description: "Object storage. Persist artifacts across ephemeral VMs. S3-compatible."
port: 3002
order: 3
phantom: false
env:
  - PRIM_PAY_TO
  - PRIM_NETWORK
  - CLOUDFLARE_ACCOUNT_ID
  - R2_ACCESS_KEY_ID
  - R2_SECRET_ACCESS_KEY
  - WALLET_INTERNAL_URL
pricing:
  - op: "Storage"
    price: "$0.02/GB/mo"
    note: "Prorated daily"
  - op: "Upload"
    price: "free"
    note: "Up to 5GB per object"
  - op: "Download"
    price: "$0.01/GB"
    note: "CDN edge delivery"
  - op: "API calls"
    price: "$0.001/call"
    note: "PUT, GET, LIST, DELETE"

deploy:
  max_body_size: "128MB"
  access_log: true

providers:
  - name: cloudflare-r2
    env: [CLOUDFLARE_ACCOUNT_ID, R2_ACCESS_KEY_ID, R2_SECRET_ACCESS_KEY]
    status: active
    default: true
    url: https://developers.cloudflare.com/r2/

interfaces:
  mcp: true
  cli: true
  tools: true
  rest: true

factory:
  max_body_size: "128MB"
  metrics: true
  free_service: false


nounStyled: "The agent-native object store."
tagline: "Zero servers. One bucket. Infinite objects."
sub: "Persist files across ephemeral VMs. S3-compatible."

hero_badges:
  - "**x402** auth"
  - "**S3** compatible"
  - "**CDN** edge delivery"
  - "**Signed** URLs"

hero_example: |
  # Upload a file
  $ curl -X PUT https://store.prim.sh/v1/objects/results.json \
      -H "X-402-Payment: $TOKEN" \
      -H "Content-Type: application/json" \
      -d @results.json

  { "id": "obj_k9m2x7", "url": "https://cdn.store.sh/obj_k9m2x7", "size": 4096 }

  # Create a bucket for a project
  $ curl -X POST https://store.prim.sh/v1/buckets \
      -H "X-402-Payment: $TOKEN" \
      -d '{"name": "training-run-042", "ttl": 604800}'

  # Share via signed URL (no auth needed to download)
  $ curl -X POST https://store.prim.sh/v1/objects/obj_k9m2x7/share \
      -H "X-402-Payment: $TOKEN" \
      -d '{"expires": 3600}'

quick_start:
  - "POST /v1/buckets → create a bucket ($0.05)"
  - "PUT /v1/buckets/:id/objects/:key with raw bytes body → upload object"
  - "GET /v1/buckets/:id/objects/:key → download object"

tips:
  - "Wallet address from x402 payment is the bucket owner. No separate auth needed."
  - "Content-Length header is required on PUT — missing it returns 411."
  - "Key may include slashes (e.g. notes/2026/feb.txt) for path-like organization."
  - "Call POST /v1/buckets/:id/quota/reconcile if usage_bytes seems incorrect after bulk deletes."
  - "Delete all objects before deleting a bucket — non-empty bucket delete is rejected."

limits:
  - "Max buckets per wallet: 10"
  - "Default per-bucket quota: 100 MB"
  - "Max total storage per wallet: 1 GB"
  - "Max object size: 5 GB (limited by max_body_size: 128MB for API)"

ownership: "All buckets and objects are scoped to the wallet address extracted from the x402 payment. Callers can only access their own buckets."

routes_map:
  - route: "POST /v1/buckets"
    request: CreateBucketRequest
    response: CreateBucketResponse
    status: 201
    description: "Create a new storage bucket"
    operation_id: create_bucket
    request_type: CreateBucketRequest
    response_type: CreateBucketResponse
    errors:
      - { status: 400, code: invalid_request, description: "Invalid bucket name or name already taken" }
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: bucket_limit_exceeded, description: "Wallet has reached 10 bucket limit" }
      - { status: 502, code: r2_error, description: "Upstream R2 error" }
  - route: "GET /v1/buckets"
    request: null
    response: BucketListResponse
    status: 200
    description: "List all buckets owned by the calling wallet"
    operation_id: list_buckets
    request_type: null
    response_type: BucketListResponse
    query_params:
      - { name: limit, type: integer, description: "1-100, default 20" }
      - { name: page, type: integer, description: "1-based page number, default 1" }
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Missing wallet address in payment" }
  - route: "GET /v1/buckets/:id"
    request: null
    response: BucketResponse
    status: 200
    description: "Get details for a single bucket. Caller must own the bucket."
    operation_id: get_bucket
    request_type: null
    response_type: BucketResponse
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Bucket belongs to a different wallet" }
      - { status: 404, code: not_found, description: "Bucket not found" }
  - route: "DELETE /v1/buckets/:id"
    request: null
    response: null
    status: 200
    description: "Delete a bucket. Bucket must be empty first."
    operation_id: delete_bucket
    request_type: null
    response_type: null
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Bucket belongs to a different wallet" }
      - { status: 404, code: not_found, description: "Bucket not found" }
      - { status: 502, code: r2_error, description: "Upstream R2 error" }
  - route: "PUT /v1/buckets/:id/objects/:key"
    request: null
    response: PutObjectResponse
    status: 200
    description: "Upload an object. Key may include slashes. Content-Length header required."
    notes: "Request body is raw bytes. Fails with 413 if upload exceeds quota."
    operation_id: put_object
    request_type: null
    response_type: PutObjectResponse
    errors:
      - { status: 400, code: invalid_request, description: "Missing or invalid body" }
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Bucket belongs to a different wallet" }
      - { status: 404, code: not_found, description: "Bucket not found" }
      - { status: 413, code: quota_exceeded, description: "Upload would exceed bucket quota" }
      - { status: 413, code: storage_limit_exceeded, description: "Upload would exceed wallet 1 GB limit" }
      - { status: 502, code: r2_error, description: "Upstream R2 error" }
  - route: "GET /v1/buckets/:id/objects"
    request: null
    response: ObjectListResponse
    status: 200
    description: "List objects in a bucket. Cursor-based pagination."
    operation_id: list_objects
    request_type: null
    response_type: ObjectListResponse
    query_params:
      - { name: prefix, type: string, description: "Filter by key prefix (e.g. notes/)" }
      - { name: limit, type: integer, description: "1-1000, default 100" }
      - { name: cursor, type: string, description: "Cursor from previous response's next_cursor" }
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Bucket belongs to a different wallet" }
      - { status: 404, code: not_found, description: "Bucket not found" }
      - { status: 502, code: r2_error, description: "Upstream R2 error" }
  - route: "GET /v1/buckets/:id/objects/:key"
    request: null
    response: "Raw bytes (application/octet-stream)"
    status: 200
    description: "Download an object. Response body is streamed directly."
    operation_id: get_object
    request_type: null
    response_type: null
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Bucket belongs to a different wallet" }
      - { status: 404, code: not_found, description: "Bucket or object not found" }
      - { status: 502, code: r2_error, description: "Upstream R2 error" }
  - route: "DELETE /v1/buckets/:id/objects/:key"
    request: null
    response: DeleteObjectResponse
    status: 200
    description: "Delete an object from a bucket"
    operation_id: delete_object
    request_type: null
    response_type: DeleteObjectResponse
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Bucket belongs to a different wallet" }
      - { status: 404, code: not_found, description: "Bucket or object not found" }
      - { status: 502, code: r2_error, description: "Upstream R2 error" }
  - route: "GET /v1/buckets/:id/quota"
    request: null
    response: QuotaResponse
    status: 200
    description: "Get quota and usage for a bucket"
    operation_id: get_quota
    request_type: null
    response_type: QuotaResponse
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Bucket belongs to a different wallet" }
      - { status: 404, code: not_found, description: "Bucket not found" }
  - route: "PUT /v1/buckets/:id/quota"
    request: SetQuotaRequest
    response: QuotaResponse
    status: 200
    description: "Set the storage quota for a bucket. Pass null to reset to default (100 MB)."
    operation_id: set_quota
    request_type: SetQuotaRequest
    response_type: QuotaResponse
    errors:
      - { status: 400, code: invalid_request, description: "Invalid quota value" }
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Bucket belongs to a different wallet" }
      - { status: 404, code: not_found, description: "Bucket not found" }
      - { status: 502, code: r2_error, description: "Upstream R2 error" }
  - route: "POST /v1/buckets/:id/quota/reconcile"
    request: null
    response: ReconcileResponse
    status: 200
    description: "Recompute bucket usage by scanning actual R2 storage. Use when usage_bytes appears incorrect."
    operation_id: reconcile_quota
    request_type: null
    response_type: ReconcileResponse
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Bucket belongs to a different wallet" }
      - { status: 404, code: not_found, description: "Bucket not found" }
      - { status: 502, code: r2_error, description: "Upstream R2 error" }

cta:
  headline: "Storage is an **API call**."
  sub: "Agents don't have hard drives. They have store.sh."

sections:
  - type: cards
    title: "What agents"
    highlight: "use it for"
    items:
      - title: "Persist across VMs"
        body: "spawn.sh VPS is ephemeral. Before destroying, upload artifacts to store.sh. Next VPS pulls them down. State survives infrastructure."
      - title: "Share between agents"
        body: "Agent A produces a dataset. Uploads to store.sh. Agent B on a different VPS downloads it. No shared filesystem needed."
      - title: "Model artifacts"
        body: "Training runs produce checkpoints, logs, weights. Store them with TTLs. Keep the best, let the rest expire."
      - title: "Public hosting"
        body: "Agent builds a static site. Uploads HTML/CSS/JS. Gets a CDN URL. Website deployed without a web server."

  - type: code
    title: "API"
    highlight: "reference"
    lines:
      - "# Buckets"
      - "POST   /v1/buckets                          # Create bucket"
      - "GET    /v1/buckets                          # List buckets"
      - "GET    /v1/buckets/:id                      # Bucket details"
      - "DELETE /v1/buckets/:id                      # Delete bucket (must be empty)"
      - ""
      - "# Objects"
      - "PUT    /v1/buckets/:id/objects/:key         # Upload object"
      - "GET    /v1/buckets/:id/objects              # List objects"
      - "GET    /v1/buckets/:id/objects/:key         # Download object"
      - "DELETE /v1/buckets/:id/objects/:key         # Delete object"
      - ""
      - "# Quota"
      - "GET    /v1/buckets/:id/quota                # Get quota + usage"
      - "PUT    /v1/buckets/:id/quota                # Set quota"
      - "POST   /v1/buckets/:id/quota/reconcile      # Recompute usage from R2"
