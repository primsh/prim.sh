id: domain
name: domain.sh
status: hold
endpoint: domain.prim.sh
type: domains
category: identity
card_class: p6
description: "Register domains, manage DNS, auto-TLS. Full domain lifecycle via API."
port: 3009
order: 9
phantom: false
env:
  - PRIM_PAY_TO
  - PRIM_NETWORK
  - CLOUDFLARE_API_TOKEN
  - CLOUDFLARE_ZONE_ID
  - NAMESILO_API_KEY
  - WALLET_INTERNAL_URL
pricing:
  - op: "Domain registration"
    price: "dynamic"
    note: "Quoted via /quote"
  - op: "DNS zone"
    price: "$0.05"
    note: "Unlimited records"
  - op: "DNS record"
    price: "$0.001"
    note: "Per operation"
  - op: "DNS queries"
    price: "free"
    note: "First 1M/mo"

providers:
  - name: cloudflare
    env: [CLOUDFLARE_API_TOKEN, CLOUDFLARE_ZONE_ID]
    status: active
    default: true
    url: https://www.cloudflare.com/
  - name: namesilo
    env: [NAMESILO_API_KEY]
    status: active
    default: false
    url: https://www.namesilo.com/

interfaces:
  mcp: true
  cli: true
  tools: true
  rest: true

factory:
  max_body_size: "1MB"
  metrics: true
  free_service: false


nounStyled: "The agent-native registrar."
tagline: "Zero registrars. One call. Infinite domains."
sub: "Instant subdomains with auto-TLS. DNS records via API."

hero_badges:
  - "**x402** auth"
  - "**Auto** TLS"
  - "**Instant** subdomains"
  - "**BYOD** custom domains"

hero_example: |
  # Get a subdomain with TLS instantly
  $ curl -X POST https://domain.prim.sh/v1/subdomains \
      -H "X-402-Payment: $TOKEN" \
      -d '{"name": "my-app", "target": "198.51.100.1"}'

  { "domain": "my-app.prim.sh", "target": "198.51.100.1",
    "tls": true, "cert_status": "provisioning" }

  # Or manage DNS records for your own domain
  $ curl -X POST https://domain.prim.sh/v1/zones/mysite.com/records \
      -H "X-402-Payment: $TOKEN" \
      -d '{"type": "A", "name": "@", "value": "198.51.100.1"}'

quick_start:
  - "GET /v1/domains/search?query=myagent&tlds=com,xyz → check availability"
  - "POST /v1/domains/quote with {domain, years} → get price quote (15-min validity)"
  - "POST /v1/zones with {domain} → create Cloudflare DNS zone ($0.05)"
  - "POST /v1/zones/:zoneId/records → add DNS records"

tips:
  - "Domain registration is async: save the recovery_token in case zone setup fails."
  - "Use POST /v1/domains/recover with recovery_token to retry Cloudflare zone setup after partial failure."
  - "POST /v1/zones/:zoneId/mail-setup configures MX, SPF, DMARC, DKIM in a single idempotent call."
  - "POST /v1/zones/:zoneId/records/batch for bulk record changes in one atomic request."
  - "GET /v1/zones/:zoneId/verify checks DNS propagation for all zone records."

limits:
  - "Domain price quotes valid for 15 minutes (quote_expired error after)"
  - "Rate limit on PUT /v1/zones/:zoneId/activate — back off before retrying"

ownership: "All DNS zones and records are scoped to the wallet address extracted from the x402 payment."

routes_map:
  - route: "GET /v1/domains/search"
    request: null
    response: DomainSearchResponse
    status: 200
    description: "Check availability and pricing for a domain query"
    operation_id: search_domains
    request_type: null
    response_type: DomainSearchResponse
    query_params:
      - { name: query, type: string, description: "Domain name or keyword to search" }
      - { name: tlds, type: string, description: "Comma-separated TLDs (e.g. com,xyz,io)" }
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 502, code: registrar_error, description: "NameSilo API error" }
  - route: "POST /v1/domains/quote"
    request: QuoteRequest
    response: QuoteResponse
    status: 200
    description: "Get a 15-minute price quote for a domain"
    operation_id: quote_domain
    request_type: QuoteRequest
    response_type: QuoteResponse
    errors:
      - { status: 400, code: invalid_request, description: "Missing domain or invalid years" }
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 502, code: registrar_error, description: "NameSilo API error" }
  - route: "GET /v1/domains/:domain/status"
    request: null
    response: RegistrationStatusResponse
    status: 200
    description: "Full post-registration pipeline status (ns_propagated, zone_active, all_ready)"
    operation_id: get_domain_status
    request_type: null
    response_type: RegistrationStatusResponse
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 404, code: not_found, description: "Domain not found" }
  - route: "POST /v1/zones"
    request: CreateZoneRequest
    response: CreateZoneResponse
    status: 201
    description: "Create a Cloudflare DNS zone. Returns nameservers to set at your registrar."
    operation_id: create_zone
    request_type: CreateZoneRequest
    response_type: CreateZoneResponse
    errors:
      - { status: 400, code: invalid_request, description: "Missing domain or invalid domain name" }
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 409, code: domain_taken, description: "Zone already exists for this domain" }
      - { status: 502, code: cloudflare_error, description: "Cloudflare API error" }
  - route: "GET /v1/zones"
    request: null
    response: ZoneListResponse
    status: 200
    description: "List DNS zones owned by the calling wallet (paginated)"
    operation_id: list_zones
    request_type: null
    response_type: ZoneListResponse
    query_params:
      - { name: limit, type: integer, description: "1-100, default 20" }
      - { name: after, type: string, description: "Cursor from previous response" }
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource belongs to a different wallet" }
  - route: "GET /v1/zones/:id"
    request: null
    response: ZoneResponse
    status: 200
    description: "Get zone details"
    operation_id: get_zone
    request_type: null
    response_type: ZoneResponse
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource belongs to a different wallet" }
      - { status: 404, code: not_found, description: "Zone not found" }
  - route: "DELETE /v1/zones/:id"
    request: null
    response: null
    status: 200
    description: "Delete zone and all records. Irreversible."
    operation_id: delete_zone
    request_type: null
    response_type: null
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource belongs to a different wallet" }
      - { status: 404, code: not_found, description: "Zone not found" }
      - { status: 502, code: cloudflare_error, description: "Cloudflare API error" }
  - route: "PUT /v1/zones/:zone_id/activate"
    request: null
    response: ActivateResponse
    status: 200
    description: "Request Cloudflare NS re-check for faster activation"
    operation_id: activate_zone
    request_type: null
    response_type: ActivateResponse
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource belongs to a different wallet" }
      - { status: 404, code: not_found, description: "Zone not found" }
      - { status: 429, code: rate_limited, description: "Too many zone_activate calls" }
  - route: "GET /v1/zones/:zone_id/verify"
    request: null
    response: VerifyResponse
    status: 200
    description: "Check DNS propagation for all zone records"
    operation_id: verify_zone
    request_type: null
    response_type: VerifyResponse
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource belongs to a different wallet" }
      - { status: 404, code: not_found, description: "Zone not found" }
  - route: "POST /v1/zones/:zone_id/mail-setup"
    request: MailSetupRequest
    response: MailSetupResponse
    status: 200
    description: "Configure MX, SPF, DMARC, DKIM in one call. Idempotent."
    operation_id: setup_mail
    request_type: MailSetupRequest
    response_type: MailSetupResponse
    errors:
      - { status: 400, code: invalid_request, description: "Missing required mail server fields" }
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource belongs to a different wallet" }
      - { status: 404, code: not_found, description: "Zone not found" }
      - { status: 502, code: cloudflare_error, description: "Cloudflare API error" }
  - route: "POST /v1/zones/:zone_id/records/batch"
    request: BatchRecordsRequest
    response: BatchRecordsResponse
    status: 200
    description: "Create, update, and delete DNS records in one atomic request"
    operation_id: batch_records
    request_type: BatchRecordsRequest
    response_type: BatchRecordsResponse
    errors:
      - { status: 400, code: invalid_request, description: "Invalid record fields or values" }
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource belongs to a different wallet" }
      - { status: 404, code: not_found, description: "Zone or record not found" }
      - { status: 502, code: cloudflare_error, description: "Cloudflare API error" }
  - route: "POST /v1/zones/:zone_id/records"
    request: CreateRecordRequest
    response: RecordResponse
    status: 201
    description: "Create a DNS record (A, AAAA, CNAME, MX, TXT, SRV, CAA, NS)"
    operation_id: create_record
    request_type: CreateRecordRequest
    response_type: RecordResponse
    errors:
      - { status: 400, code: invalid_request, description: "Missing or invalid record fields" }
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource belongs to a different wallet" }
      - { status: 404, code: not_found, description: "Zone not found" }
      - { status: 502, code: cloudflare_error, description: "Cloudflare API error" }
  - route: "GET /v1/zones/:zone_id/records"
    request: null
    response: RecordListResponse
    status: 200
    description: "List all records in a DNS zone"
    operation_id: list_records
    request_type: null
    response_type: RecordListResponse
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource belongs to a different wallet" }
      - { status: 404, code: not_found, description: "Zone not found" }
  - route: "GET /v1/zones/:zone_id/records/:id"
    request: null
    response: RecordResponse
    status: 200
    description: "Get a single DNS record"
    operation_id: get_record
    request_type: null
    response_type: RecordResponse
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource belongs to a different wallet" }
      - { status: 404, code: not_found, description: "Zone or record not found" }
  - route: "PUT /v1/zones/:zone_id/records/:id"
    request: UpdateRecordRequest
    response: RecordResponse
    status: 200
    description: "Update a DNS record"
    operation_id: update_record
    request_type: UpdateRecordRequest
    response_type: RecordResponse
    errors:
      - { status: 400, code: invalid_request, description: "Invalid record fields" }
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource belongs to a different wallet" }
      - { status: 404, code: not_found, description: "Zone or record not found" }
      - { status: 502, code: cloudflare_error, description: "Cloudflare API error" }
  - route: "DELETE /v1/zones/:zone_id/records/:id"
    request: null
    response: null
    status: 200
    description: "Delete a DNS record"
    operation_id: delete_record
    request_type: null
    response_type: null
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource belongs to a different wallet" }
      - { status: 404, code: not_found, description: "Zone or record not found" }
      - { status: 502, code: cloudflare_error, description: "Cloudflare API error" }

cta:
  headline: "A domain is an **API call**."
  sub: "Agents don't register domains. They provision endpoints."

sections:
  - type: cards
    title: "What agents"
    highlight: "use it for"
    items:
      - title: "Instant deploy"
        body: "Agent deploys app on spawn.sh, gets an IP. Points domain.sh subdomain at it. HTTPS in 30 seconds. No nginx config, no certbot."
      - title: "Webhook endpoints"
        body: "email.sh and ring.sh need webhook URLs. domain.sh gives them stable, TLS-secured hostnames instead of raw IPs that change on redeploy."
      - title: "Service discovery"
        body: "Agent A at api.prim.sh. Agent B at worker.prim.sh. They find each other by name, not IP. DNS is the original service mesh."
      - title: "Custom domains"
        body: "Agent builds a product, needs a real domain. Manage DNS records programmatically. Point, deploy, update — all via API."

  - type: code
    title: "API"
    highlight: "reference"
    lines:
      - "# Managed subdomains"
      - "POST   /v1/subdomains           # Create subdomain + auto-TLS"
      - "GET    /v1/subdomains           # List your subdomains"
      - "PUT    /v1/subdomains/:id       # Update target IP"
      - "DELETE /v1/subdomains/:id       # Release subdomain"
      - ""
      - "# Custom domains"
      - "POST   /v1/zones                # Add domain (returns NS records)"
      - "GET    /v1/zones/:domain/verify # Check NS delegation"
      - "POST   /v1/zones/:domain/records # Add DNS record"
      - "GET    /v1/zones/:domain/records # List records"
      - "PUT    /v1/records/:id          # Update record"
      - "DELETE /v1/records/:id          # Delete record"
      - ""
      - "# TLS"
      - "GET    /v1/subdomains/:id/cert  # Cert status + expiry"
