id: mem
name: mem.sh
status: hold
endpoint: mem.prim.sh
type: memory
category: storage
card_class: p21
description: "Vector store and cache for agents. Persist long-term knowledge and session state."
port: 3008
order: 8
phantom: false
env:
  - PRIM_PAY_TO
  - PRIM_NETWORK
  - QDRANT_URL
  - GOOGLE_API_KEY
  - WALLET_INTERNAL_URL
pricing:
  - op: "Create collection"
    price: "$0.01"
    note: ""
  - op: "Upsert (embed)"
    price: "$0.001"
    note: "Per 1k tokens"
  - op: "Query"
    price: "$0.001"
    note: "Per search"
  - op: "KV cache"
    price: "$0.0001"
    note: "Per operation"

providers:
  - name: qdrant
    env: [QDRANT_URL]
    status: active
    default: true
    url: https://qdrant.tech/

interfaces:
  mcp: true
  cli: true
  tools: true
  rest: true

factory:
  max_body_size: "1MB"
  metrics: true
  free_service: false


nounStyled: "The agent-native memory."
tagline: "Zero drift. One store. Infinite recall."
sub: "Vector store, cache, and long-term retrieval for agents."

hero_badges:
  - "**x402** auth"
  - "**Vector** store"
  - "**Session** cache"
  - "**Embeddings** included"

hero_example: |
  # Remember something
  $ curl -X POST https://mem.prim.sh/v1/collections/my-brain/upsert \
      -H "X-402-Payment: $TOKEN" \
      -d '{"text": "The user prefers dark mode.", "metadata": {"source": "chat"}}'

  # Recall it later
  $ curl -G https://mem.prim.sh/v1/collections/my-brain/query \
      -H "X-402-Payment: $TOKEN" \
      --data-urlencode "text=what does the user like?"

quick_start:
  - "POST /v1/collections with {\"name\": \"my-brain\"} → create vector collection ($0.01)"
  - "POST /v1/collections/:id/upsert with documents array → embed and store text"
  - "POST /v1/collections/:id/query with {\"text\": \"...\"} → semantic search"
  - "PUT /v1/cache/:namespace/:key with {\"value\": ..., \"ttl\": 3600} → store in KV cache"

tips:
  - "Upsert replaces existing documents with the same ID — safe to call repeatedly."
  - "GET /v1/collections list response has null document_count — use GET :id for live count."
  - "KV cache ttl is in seconds. Omit ttl for permanent storage."
  - "Use filter (Qdrant native format) in query for metadata-filtered vector search."
  - "Embedding is included — just pass text strings, no need to pre-compute vectors."

limits:
  - "Max document text size: governed by 1 MB body limit"
  - "KV cache entries: no hard limit documented"
  - "Vector dimension: 1536 (Google text-embedding-004)"

ownership: "All collections and cache entries are scoped to the wallet address extracted from the x402 payment."

routes_map:
  - route: "POST /v1/collections"
    request: CreateCollectionRequest
    response: CollectionResponse
    status: 201
    description: "Create a vector collection"
    operation_id: create_collection
    request_type: CreateCollectionRequest
    response_type: CollectionResponse
    errors:
      - { status: 400, code: invalid_request, description: "Missing name or invalid fields" }
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 409, code: collection_name_taken, description: "Name already exists for this wallet" }
      - { status: 502, code: qdrant_error, description: "Upstream Qdrant error" }
  - route: "GET /v1/collections"
    request: null
    response: CollectionListResponse
    status: 200
    description: "List collections owned by the calling wallet (paginated). document_count is null — use GET :id."
    operation_id: list_collections
    request_type: null
    response_type: CollectionListResponse
    query_params:
      - { name: limit, type: integer, description: "1-100, default 20" }
      - { name: after, type: string, description: "Cursor from previous response" }
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource belongs to a different wallet" }
  - route: "GET /v1/collections/:id"
    request: null
    response: CollectionResponse
    status: 200
    description: "Get collection with live document_count from Qdrant"
    operation_id: get_collection
    request_type: null
    response_type: CollectionResponse
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource belongs to a different wallet" }
      - { status: 404, code: not_found, description: "Collection not found" }
      - { status: 502, code: qdrant_error, description: "Upstream Qdrant error" }
  - route: "DELETE /v1/collections/:id"
    request: null
    response: null
    status: 200
    description: "Delete collection and all documents. Irreversible."
    operation_id: delete_collection
    request_type: null
    response_type: null
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource belongs to a different wallet" }
      - { status: 404, code: not_found, description: "Collection not found" }
      - { status: 502, code: qdrant_error, description: "Upstream Qdrant error" }
  - route: "POST /v1/collections/:id/upsert"
    request: UpsertRequest
    response: UpsertResponse
    status: 200
    description: "Embed and store documents. Each document: {id?, text, metadata?}. Existing IDs are replaced."
    operation_id: upsert_documents
    request_type: UpsertRequest
    response_type: UpsertResponse
    errors:
      - { status: 400, code: invalid_request, description: "Missing documents or invalid fields" }
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource belongs to a different wallet" }
      - { status: 404, code: not_found, description: "Collection not found" }
      - { status: 502, code: qdrant_error, description: "Upstream Qdrant error" }
      - { status: 502, code: embedding_error, description: "Embedding model error" }
  - route: "POST /v1/collections/:id/query"
    request: QueryRequest
    response: QueryResponse
    status: 200
    description: "Semantic search. Fields: text (required), top_k, filter (Qdrant native format)."
    operation_id: query_collection
    request_type: QueryRequest
    response_type: QueryResponse
    errors:
      - { status: 400, code: invalid_request, description: "Missing text or invalid filter" }
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 403, code: forbidden, description: "Resource belongs to a different wallet" }
      - { status: 404, code: not_found, description: "Collection not found" }
      - { status: 502, code: qdrant_error, description: "Upstream Qdrant error" }
      - { status: 502, code: embedding_error, description: "Embedding model error" }
  - route: "PUT /v1/cache/:namespace/:key"
    request: SetCacheRequest
    response: null
    status: 200
    description: "Store a value in the KV cache. Optional ttl in seconds for expiry."
    operation_id: set_cache
    request_type: SetCacheRequest
    response_type: null
    errors:
      - { status: 400, code: invalid_request, description: "Missing value" }
      - { status: 402, code: payment_required, description: "x402 payment needed" }
  - route: "GET /v1/cache/:namespace/:key"
    request: null
    response: GetCacheResponse
    status: 200
    description: "Retrieve a cache value. Returns 404 if missing or expired."
    operation_id: get_cache
    request_type: null
    response_type: GetCacheResponse
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 404, code: not_found, description: "Cache entry missing or expired" }
  - route: "DELETE /v1/cache/:namespace/:key"
    request: null
    response: null
    status: 200
    description: "Delete a cache entry"
    operation_id: delete_cache
    request_type: null
    response_type: null
    errors:
      - { status: 402, code: payment_required, description: "x402 payment needed" }
      - { status: 404, code: not_found, description: "Cache entry not found" }

cta:
  headline: "Memory is an **API call**."
  sub: "Agents don't have a hippocampus. They have vectors."

sections:
  - type: cards
    title: "What agents"
    highlight: "use it for"
    items:
      - title: "Long-term memory"
        body: "Agents spin up on spawn.sh and disappear. mem.sh persists what they learn so the next instance remembers the past."
      - title: "Knowledge retrieval (RAG)"
        body: "Upload manuals, runbooks, FAQs. Query semantically instead of stuffing 50KB of docs into every context window."
      - title: "Shared context"
        body: "A swarm of agents reads and writes to the same collection. One discovers a pattern, all of them learn it."
      - title: "Session caching"
        body: "Store short-lived conversation state and workflow checkpoints in a cheap KV cache beside the vector store."

  - type: code
    title: "API"
    highlight: "reference"
    lines:
      - "# Collections"
      - "POST   /v1/collections               # Create collection"
      - ""
      - "# Vectors"
      - "POST   /v1/collections/:id/upsert    # Text → embedding → store"
      - "GET    /v1/collections/:id/query     # Semantic search"
      - ""
      - "# Cache"
      - "POST   /v1/cache/set                 # Set key"
      - "GET    /v1/cache/get                 # Get key"
